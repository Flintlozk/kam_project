FROM node:16 as builder
RUN ln -sf /usr/share/zoneinfo/Asia/Bangkok /etc/localtime && dpkg-reconfigure -f noninteractive tzdata && apt install -y autoconf
ENV INSTALL_PROJECT_PATH /project
RUN mkdir -p $INSTALL_PROJECT_PATH
WORKDIR $INSTALL_PROJECT_PATH
RUN npm install -g @nrwl/cli
RUN npm install -g @angular/cli
ADD ./package.json .
ADD ./package-lock.json .
ADD ./decorate-angular-cli.js .
RUN npm install
RUN rm -rf ./node_modules/.cache && rm -rf ./node_modules/@storybook

FROM node:16-slim
ENV INSTALL_PROJECT_PATH /project
RUN mkdir -p $INSTALL_PROJECT_PATH
WORKDIR $INSTALL_PROJECT_PATH
COPY --from=builder /project ./

